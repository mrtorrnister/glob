<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Historyczna Europa - Globus</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    html, body, #cesiumContainer {
      width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    const viewer = new Cesium.Viewer('cesiumContainer', {
      timeline: true,
      animation: true
    });

    // Timeline: lata 1945-2025
    const start = Cesium.JulianDate.fromDate(new Date(1945,0,1));
    const stop  = Cesium.JulianDate.fromDate(new Date(2025,0,1));
    viewer.clock.startTime = start.clone();
    viewer.clock.stopTime = stop.clone();
    viewer.clock.currentTime = start.clone();
    viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP;
    viewer.clock.multiplier = 31536000; // 1 sekunda = 1 rok
    viewer.timeline.zoomTo(start, stop);

    // Wczytanie GeoJSON
    Cesium.GeoJsonDataSource.load('granice.json', { clampToGround: true })
    .then(function(dataSource) {
      viewer.dataSources.add(dataSource);
      const entities = dataSource.entities.values;

      for (let i=0; i<entities.length; i++){
        const entity = entities[i];
        const props = entity.properties;

        if(props && props.start && props.end){
          entity.availability = new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({
            start: Cesium.JulianDate.fromDate(new Date(props.start.getValue())),
            stop:  Cesium.JulianDate.fromDate(new Date(props.end.getValue()))
          })]);

          // Kolory dla państw
          const n = props.name.getValue();
          if(n === "Niemcy") entity.polygon.material = Cesium.Color.RED.withAlpha(0.4);
          else if(n === "Polska") entity.polygon.material = Cesium.Color.BLUE.withAlpha(0.4);
          else if(n === "Francja") entity.polygon.material = Cesium.Color.GREEN.withAlpha(0.4);
          else if(n === "Włochy") entity.polygon.material = Cesium.Color.YELLOW.withAlpha(0.4);

          entity.polygon.outline = true;
          entity.polygon.outlineColor = Cesium.Color.BLACK;
        }
      }
    });
  </script>
</body>
</html>
